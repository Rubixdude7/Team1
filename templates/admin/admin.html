{% extends "base.html" %}
{% block title %}Admin{% endblock %}
{% block content %}
<main id="mainHome">
    <div class="box">
        <h1 class="title">User Management</h1>
    </div>
    <div class="box">
        <h2 class="title">Users</h2>
        <hr>
        <div id="admin-form">
            <form action="" method="post" id="admin-disp-amnt">
                {{ form.hidden_tag() }}
                <!--TODO REMOVE AND PUT IN CSS-->
                <style>
                    input[type=radio]{
                        display: none;
                    }
                </style>
                <div>
                    {% for choice in form.radio %}
                        {{ choice }}
                        {{ choice.label(class="btn btn-outline-info") }}
                    {% endfor %}
                </div>
                <div>


                    <!--{{ form.search(size=85, id="search", onkeydown="search('admin-results')") }}-->
                    <!--{{ form.submit(class="btn btn-success") }} -->
                </div>

            </form>
            <input type="text" size="85" id="search" name="search" placeholder="Search" onkeydown="search('admin-results')">
        </div>
        <div class="table-wrapper">
            <table class="table" id="admin-results">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Role</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in users %}
                        <tr>
                        <td>{{ u.email }}</td>
                        <td>{{ usersandroles[u.email] }}</td>
                        {% if current_user.id == u.user_id %}

                        {% else %}
                            <td><a href="{{ url_for('edit', u_id=u.user_id) }}">Edit</a></td>
                            <td><a href="{{ url_for('delete', u_id=u.user_id) }}" onclick="confirmAction()">Delete</a></td>
                        {% endif %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <ul class="pagination">
            {% if page_num > 1 %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('admin', page_num=page_num - 1, items_per_page=items_per_page)}}">Previous Page</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="#">Previous Page</a>
                </li>
            {% endif %}
            {% if page_num != num_of_pages %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('admin', page_num=page_num + 1, items_per_page=items_per_page) }}">Next Page</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="#">Next Page</a>
                </li>
            {% endif %}
        </ul>
    </div>
<script>
function confirmAction() {
    confirm("Are you sure you want to delete this user?");
}

// basic js search function for a table
function search(tableName) {
    // Declare variables
    var input, filter, table, tr, td, i;
    input = document.getElementById("search"); // search field must be called search
    filter = input.value.toUpperCase();
    table = document.getElementById(tableName);
    tr = table.getElementsByTagName("tr");

    // Loop through all table rows, and hide those who don't match the search query
    for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0];
        if (td) {
            if (td.innerHTML.toUpperCase().indexOf(filter) > -1 || i === 0){
                tr[i].style.display = "";
            } else {
                tr[i].style.display = "none";
            }
        }
    }
}


//Submit form on radio change
$(function () {
    $('#admin-disp-amnt input[type=radio]').change(function () {
        $('#admin-disp-amnt').submit();
    });
});

</script>

</main>

{% endblock %}