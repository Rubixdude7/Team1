{% extends "base.html" %}
{% block title %}Admin{% endblock %}
{% block content %}
<main id="mainHome">
    <div class="box">
        <h1 class="title">Admin Portal</h1>
    </div>

    <div class="box">
        <h2 class="title">Users</h2>
        <hr>
        <form action="" method="post">
            {{ form.hidden_tag() }}
            <div class = form-control-1>{{ form.search(size=85) }} {{ form.submit() }} </div>

        </form>
        <div class="table-wrapper">
            <table class="table">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Role</th>
                    </tr>
                </thead>
                <tbody>
                <!-- I'm sorry in advance for this... this is the easiest way I could think of to sort based on role-->
                    {% for u in users %}
                        <tr>
                        {% if usersandroles[u.email] == 'Admin' %}
                            <td>{{ u.email }}</td>
                            <td>{{ usersandroles[u.email] }}</td>
                            {% if current_user.id == u.user_id %}

                            {% else %}
                                <td><a href="{{ url_for('edit', u_id=u.user_id) }}">Edit</a></td>
                                <td><a href="{{ url_for('delete', u_id=u.user_id) }}" onclick="confirmAction()">Delete</a></td>
                            {% endif %}
                        {% endif %}
                        </tr>
                    {% endfor %}
                    {% for u in users %}
                        <tr>
                        {% if usersandroles[u.email] == 'Office Staff' %}
                            <td>{{ u.email }}</td>
                            <td>{{ usersandroles[u.email] }}</td>
                            {% if current_user.id == u.user_id %}

                            {% else %}
                                <td><a href="{{ url_for('edit', u_id=u.user_id) }}">Edit</a></td>
                                <td><a href="{{ url_for('delete', u_id=u.user_id) }}" onclick="confirmAction()">Delete</a></td>
                            {% endif %}
                        {% endif %}
                        </tr>
                    {% endfor %}
                    {% for u in users %}
                        <tr>
                        {% if usersandroles[u.email] == 'Psychologist' %}
                            <td>{{ u.email }}</td>
                            <td>{{ usersandroles[u.email] }}</td>
                            {% if current_user.id == u.user_id %}

                            {% else %}
                                <td><a href="{{ url_for('edit', u_id=u.user_id) }}">Edit</a></td>
                                <td><a href="{{ url_for('delete', u_id=u.user_id) }}" onclick="confirmAction()">Delete</a></td>
                            {% endif %}
                        {% endif %}
                        </tr>
                    {% endfor %}
                    {% for u in users %}
                        <tr>
                        {% if usersandroles[u.email] == 'User' %}
                            <td>{{ u.email }}</td>
                            <td>{{ usersandroles[u.email] }}</td>
                            {% if current_user.id == u.user_id %}

                            {% else %}
                                <td><a href="{{ url_for('edit', u_id=u.user_id) }}">Edit</a></td>
                                <td><a href="{{ url_for('delete', u_id=u.user_id) }}" onclick="confirmAction()">Delete</a></td>
                            {% endif %}
                        {% endif %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <p>
            {% if page_num > 1 %}
                <a href="{{ url_for('admin', page_num=page_num - 1) }}">Previous Page</a>
            {% else %}
                Previous Page
            {% endif %}
            /
            <a href="{{ url_for('admin', page_num=page_num + 1) }}">Next Page</a>
        </p>
    </div>
<script>
function confirmAction() {
    confirm("Are you sure you want to delete this user?");
}

</script>

</main>

{% endblock %}